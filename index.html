<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>VKID Авторизация</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- VKID SDK -->
  <script src="https://unpkg.com/@vkid/sdk@<3.0.0/dist-sdk/umd/index.js"></script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: Arial, sans-serif;
    }

    #vkid-root {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 150px;
    }
  </style>
</head>
<body>

  <div id="vkid-root"></div>

  <script type="text/javascript">
    if ('VKIDSDK' in window) {
      const VKID = window.VKIDSDK;

      VKID.Config.init({
        app: 53689889,
        redirectUrl: 'https://golfo-developer.github.io/mz/main.html',
        responseMode: VKID.ConfigResponseMode.Callback,
        source: VKID.ConfigSource.LOWCODE,
        scope: '',
      });

      const floatingOneTap = new VKID.FloatingOneTap();

      floatingOneTap.render({
        appName: 'MZ HELPER',
        showAlternativeLogin: true
      })
      .on(VKID.WidgetEvents.ERROR, vkidOnError)
      .on(VKID.FloatingOneTapInternalEvents.LOGIN_SUCCESS, function (payload) {
        const code = payload.code;
        const deviceId = payload.device_id;

        VKID.Auth.exchangeCode(code, deviceId)
          .then(vkidOnSuccess)
          .catch(vkidOnError);
      });

      function vkidOnSuccess(data) {
        console.log('Авторизация прошла успешно', data);
        floatingOneTap.close();

        // Можно сохранить данные, если нужно
        localStorage.setItem('vk_access_token', data.access_token);
        localStorage.setItem('vk_user_id', data.user.id);

        // Перенаправление на основную страницу
        window.location.href = '/mz/main.html';
      }

      function vkidOnError(error) {
        console.error('Ошибка авторизации:', error);
        alert('Ошибка авторизации. Попробуйте позже.');
      }
    } else {
      console.error('VKID SDK не загружен');
    }
  </script>

</body>
</html>
