<!DOCTYPE html>
<html>
<head>
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∏–∫–∞–∑–æ–≤ –¶–ì–ë-–ù</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        .auth-section { margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        input, textarea, select { width: 100%; padding: 8px; margin-top: 5px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 15px; cursor: pointer; }
        #result { margin-top: 20px; white-space: pre-line; border: 1px solid #ddd; padding: 15px; }
        #user-data { display: none; }
    </style>
    <!-- Firebase + VK SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://vk.com/js/api/openapi.js?169"></script>
</head>
<body>
    <div id="auth-section" class="auth-section">
        <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ</h2>
        <button onclick="loginVK()">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ VK</button>
    </div>

    <div id="user-data">
        <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="user-name"></span>!</h2>
        <p>–í–∞—à–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å: <span id="user-position"></span></p>
    </div>

    <div id="order-form" style="display: none;">
        <h1>üìú –ü—Ä–∏–∫–∞–∑ –æ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h1>
        <div class="form-group">
            <label>–§–ò–û –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
            <input type="text" id="new-employee" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
        </div>
        <div class="form-group">
            <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</label>
            <input type="text" id="employee-position" placeholder="–§–µ–ª—å–¥—à–µ—Ä">
        </div>
        <div class="form-group">
            <label>–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è:</label>
            <input type="date" id="accept-date">
        </div>
        <button onclick="generateAcceptOrder()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–∫–∞–∑</button>
        <div id="result"></div>
        <button onclick="copyToClipboard()" id="copyBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥ Firebase (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π!)
        const firebaseConfig = {
            apiKey: "–í–ê–®_API_KEY",
            authDomain: "–í–ê–®_PROJECT.firebaseapp.com",
            projectId: "–í–ê–®_PROJECT",
            storageBucket: "–í–ê–®_PROJECT.appspot.com",
            messagingSenderId: "–í–ê–®_SENDER_ID",
            appId: "–í–ê–®_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK API
        VK.init({ apiId: –í–ê–®_VK_APP_ID });

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ VK
        function loginVK() {
            VK.Auth.login(response => {
                if (response.session) {
                    const vkToken = response.session.sid;
                    const credential = firebase.auth.VKAuthProvider.credential(vkToken);
                    
                    auth.signInWithCredential(credential)
                        .then(userCred => {
                            const user = userCred.user;
                            document.getElementById("auth-section").style.display = "none";
                            document.getElementById("user-data").style.display = "block";
                            document.getElementById("order-form").style.display = "block";
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            db.collection("users").doc(user.uid).set({
                                name: `${user.displayName}`,
                                vkId: response.session.mid,
                                lastLogin: new Date()
                            }, { merge: true });
                            
                            document.getElementById("user-name").textContent = user.displayName;
                        });
                }
            }, 4); // 4 - –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª—è
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∫–∞–∑–∞
        function generateAcceptOrder() {
            const newEmployee = document.getElementById("new-employee").value;
            const position = document.getElementById("employee-position").value;
            const date = document.getElementById("accept-date").value || new Date().toLocaleDateString();
            
            const orderText = `[–¶–ì–ë-–ù] –ü—Ä–∏–∫–∞–∑ –æ –ø—Ä–∏–Ω—è—Ç–∏–∏ #${Math.floor(Math.random() * 9000) + 1000}\n\n` +
                             `–ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∑–∞—è–≤–ª–µ–Ω–∏—è –∏ —Ç—Ä—É–¥–æ–≤–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞\n` +
                             `–ü–†–ò–ù–ò–ú–ê–Æ:\n` +
                             `${newEmployee} –Ω–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å ${position}\n` +
                             `–î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –¥–æ–ª–∂–Ω–æ—Å—Ç—å: ${date}\n\n` +
                             `–ü–æ–¥–ø–∏—Å–∞–Ω–æ: ________________ (${auth.currentUser.displayName})`;
            
            document.getElementById("result").textContent = orderText;
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä
        function copyToClipboard() {
            navigator.clipboard.writeText(document.getElementById("result").textContent);
            alert("–ü—Ä–∏–∫–∞–∑ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
        }
    </script>
</body>
</html>
